<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;"/><link rel="shortcut icon" type="image/x-icon" href="/PS70/public/images/favicon.ico"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><title>PS70 Portfolio: Final Project</title><meta name="next-head-count" content="7"/><link rel="preload" href="/PS70/_next/static/css/3c78ce5e89065624.css" as="style"/><link rel="stylesheet" href="/PS70/_next/static/css/3c78ce5e89065624.css" data-n-g=""/><link rel="preload" href="/PS70/_next/static/css/dc5f60ce80c8a045.css" as="style"/><link rel="stylesheet" href="/PS70/_next/static/css/dc5f60ce80c8a045.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/PS70/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/PS70/_next/static/chunks/webpack-c8325099d872d89b.js" defer=""></script><script src="/PS70/_next/static/chunks/framework-3671d8951bf44e4e.js" defer=""></script><script src="/PS70/_next/static/chunks/main-a5da62eb29698393.js" defer=""></script><script src="/PS70/_next/static/chunks/pages/_app-aaad3cb9c0107041.js" defer=""></script><script src="/PS70/_next/static/chunks/1664-c7720be4a11717d6.js" defer=""></script><script src="/PS70/_next/static/chunks/7406-7a20c54e32fa9a09.js" defer=""></script><script src="/PS70/_next/static/chunks/9927-b8ecc6eee13e613e.js" defer=""></script><script src="/PS70/_next/static/chunks/pages/finalproject-26251b216382b244.js" defer=""></script><script src="/PS70/_next/static/qLkYmdwpuw8oBP6NAldma/_buildManifest.js" defer=""></script><script src="/PS70/_next/static/qLkYmdwpuw8oBP6NAldma/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div><div class="Header_header__l1qoc"><img alt="Final Project" src="https://i.imgur.com/N4wXRa1.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:cover;color:transparent"/><div class="Header_title__MaSJ1"><h1>Final Project</h1></div></div><div class="Content_content__pTaRN"><style data-emotion="css 1rz5h4">.css-1rz5h4{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex-wrap:wrap;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;width:100%;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;width:calc(100% + 40px);margin-left:-40px;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;margin-top:40px;}.css-1rz5h4>.MuiGrid-item{padding-left:40px;}</style><div class="MuiGrid-root MuiGrid-container css-1rz5h4"><style data-emotion="css 15j76c0">.css-15j76c0{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}@media (min-width:600px){.css-15j76c0{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-15j76c0{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:1200px){.css-15j76c0{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:1536px){.css-15j76c0{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-15j76c0"><div class="Content_section__fSmTW">Final Project: Smart Alarm Clock</div><video width="80%" height="auto" controls=""><source src="final_video.mp4" type="video/mp4"/></video></div><style data-emotion="css sz8yim">.css-sz8yim{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;margin-top:80px;}@media (min-width:600px){.css-sz8yim{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:900px){.css-sz8yim{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:1200px){.css-sz8yim{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}@media (min-width:1536px){.css-sz8yim{-webkit-flex-basis:100%;-ms-flex-preferred-size:100%;flex-basis:100%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:100%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW">Project Motivation &amp; Overview</div><div class="Content_text__dw89L"><p>For almost the entirety of the first semester (and much of second semester as well), I struggled to wake up on time. Using only my phone&#x27;s built in clock app, I found it too easy to sleep through alarms or ignore them until I was late for class. When I nearly missed a final exam, I knew it was time for a change.</p><p>Ultimately, this change came in the form of a &quot;smart alarm clock&quot;—one with enough features to truly motivate me to get out of bed. In particular, the alarm clock that I created is able to play a tone, open the blinds, and spray you with water when it is time to wake up.</p><p>As portrayed in the video above, the process for using this alarm clock is as follows:</p><ol class="Content_list__KcVo5"><li>Set the alarm using the web interface at <a href="https://ps-70-clock.vercel.app/" target="_blank">www.ps-70-clock.vercel.app</a></li><li>Wait for the alarm to sound at the set time.</li><li>Initially, the alarm clock will play a pleasent tone and open the blinds.</li><li>If the button is pressed during this time, the alarm will be silenced and the system will reset.</li><li>However, if the alarm is not silenced during the initial song, the system will begin spraying water out of a nozzle and playing a more aggrevating tone until it is silenced.</li></ol><p>While this system is not perfect, it is certainly more motivating than my previous alarm clock! Indeed, I look forward to using it for all of my early-morning alarms going forward.</p></div></div><style data-emotion="css 1udb513">.css-1udb513{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}@media (min-width:600px){.css-1udb513{-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}}@media (min-width:900px){.css-1udb513{-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}}@media (min-width:1200px){.css-1udb513{-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}}@media (min-width:1536px){.css-1udb513{-webkit-flex-basis:33.333333%;-ms-flex-preferred-size:33.333333%;flex-basis:33.333333%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:33.333333%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-4 css-1udb513"><div class="Content_rectanglemargins__RNF6q"><img alt="Alarm Clock" src="/PS70/_next/static/media/alarm3.8c3e2365.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-4 css-1udb513"><div class="Content_rectanglemargins__RNF6q"><img alt="Alarm Clock" src="/PS70/_next/static/media/alarm1.1f8df6a8.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-4 css-1udb513"><div class="Content_rectanglemargins__RNF6q"><img alt="Alarm Clock" src="/PS70/_next/static/media/alarm2.5c0349ab.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-15j76c0"><div class="Content_section__fSmTW">Bill of Materials</div><div class="Content_text__dw89L">To create this project, I used the following components. To keep things simple and affordable, all of these components were sourced directly from the lab.<ul class="Content_list__KcVo5"><li>2 x ESP32 S2 - To control the alarm clock system and shade/water system, respectively</li><li>1 x LCD Screen - To display the appropriate time and alarm status</li><li>1 x Piezo Buzzer (Large) - To generate alarm sounds as appropriate</li><li>1 x Small Tactile Button - For silencing the alarm</li><li>1 x DC 3V 12A Mini Air Pump - To spray water from the reservoir</li><li>1 x 5V Relay Module - To control power to the pump</li><li>1 x Nema 17 Stepper Motor - To raise and lower the blinds</li><li>1 x DRV8834 Low-Voltage Stepper Driver - To control the stepper motor</li><li>1 x 100uF Capacitor - For protecting the stepper motor driver from voltage spikes</li><li>1 x 10kΩ Resistor - For reading the digital input from the button</li><li>6 x M6 x 10mm Screws - For assembling the stepper motor holder and attaching it to the rest of the system</li><li>2 x 5V Power Supply - For powering the alarm clock and shade/water systems</li><li>1 x 6mm Thick Sheet of Plywood - For laser cutting the respective component housings</li><li>~250 g of PLA Plastic - For 3D printing the necessary components</li></ul></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW">Component Overview</div><div class="Content_text__dw89L"><p>As can be seen in the demo video above, this alarm clock is actually composed of three subsystems—a software system to set the time and transmit it to the ESP32s, an alarm clock system to display the current time and sound an alarm, and a shade/water system to open the blinds and spray the user with water. </p><p>While the latter two systems <i>could</i> have been combined into one, I made the decision early on to seperate them. Not only did this allow me to position the spray nozzle and blind pulling system exactly where I wanted it, but it also forced the user to move further to silence the alarm—thereby ensuring that you are even more awake by the time the alarm is finished.</p><p>To create this project, I worked on each of the three systems in weeks 10, 11, and 12/13, respectively. My week by week progress on each of these systems can be seen in the documentation below!</p></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW" id="SoftwareSystem">Software System (Week 10)</div><div class="Content_rectanglemargins__RNF6q"><img alt="Software" src="/PS70/_next/static/media/clocksoftware.6b2d845d.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div><div class="Content_text__dw89L"><p>In week 10, we were tasked with &quot;making a serious attempt at the most challenging/intimidating aspect of [the] final project.&quot; Seeing as I was making an alarm clock, some of the most critical aspects to nail down were those surrounding the time.</p><p>In particular, I decided early on that it would be more interesting to have users set the time on an internet-connected device rather than on the alarm clock itself. However, to create this functionality, I needed to develop both a frontend and a backend application. Ultimately, I chose to accomplish this by building a frontend site using React and Material UI, and a backend API using Node.js and Express.</p><p>On the frontend, I used the built-in Date() object in Javascript to determine the current time and <a href="https://mui.com/x/react-date-pickers/time-picker/" target="_blank">Material UI&#x27;s time picker component</a> to allow users to choose a desired alarm time. Once they do so, it is displayed and sent to the backend via a POST request.</p><p>The backend itself was built using Node.js and Express, with seperate endpoints for the alarm time and the state that the alarm clock is currently in (with different integers corresponding to the shade opening, water spraying, etc.) Moreover, both the frontend and backend sites were hosted using <a href="https://vercel.com/dashboard" target="_blank">Vercel</a>—a tool for deploying basic web applications for free. This allowed me (and anyone else) to use both the frontend and backend 24/7.</p><p>To finish the minimum viable product, I used an <a href="https://nathanmelenbrink.github.io/ps70/09_networking/index.html" target="_blank">in-class tutorial that we had followed</a> to connect an ESP32 to the internet and to the backend that I had just created. To ensure that the ESP32 always had the current time, I also connected it to <a href="https://timeapi.io/" target="_blank">timeapi.io</a>—a free API that returns the time in an easy to use format. By the end of the week, the ESP32 was able to print out whether or not the current time matched a time the user had set!</p><p>For reference, the full code for both the frontend site and backend API is below:</p></div><a href="https://ps-70-clock.vercel.app/" target="_blank"><button class="Content_button__ikLVm">Frontend Site</button></a><a href="https://ps70-final.vercel.app/state" target="_blank"><button class="Content_button__ikLVm">Backend API</button></a><div class="Content_code__iv5f1"><div class="sc-gswNZR inUGyR"><span style="font-size:inherit;font-family:inherit;background:white;color:black;border-radius:3px;display:inline;line-height:1.4285714285714286;overflow-x:auto;white-space:pre-wrap;padding:2px 4px"><code>import &#x27;./App.css&#x27;;
import dayjs from &#x27;dayjs&#x27;;
import { useState, useEffect } from &#x27;react&#x27;;
import { enUS } from &quot;@mui/material/locale&quot;;
import { LocalizationProvider } from &#x27;@mui/x-date-pickers&#x27;;
import { AdapterDayjs } from &#x27;@mui/x-date-pickers/AdapterDayjs&#x27;;
import Container from &quot;@mui/material/Container&quot;;
import Box from &quot;@mui/material/Box&quot;;
import Typography from &quot;@mui/material/Typography&quot;;
import Alarm from &#x27;./Alarm&#x27;;

function App() {
  const [alarm, setAlarm] = useState(dayjs(&#x27;2022-04-17T15:30&#x27;));
  const [alarmSet, setAlarmSet] = useState(false);
  const [loading, setLoading] = useState(true);
  const [time, setTime] = useState(new Date());

  async function getAPI(url) {
    
    const response = await fetch(url);
    
    let data = await response.json();
    console.log(data);
    if (response) {
        setLoading(false);
        setAlarm(data.alarm);
        if (data.alarm !== &quot;&quot;) {
          setAlarmSet(true);
        } else {
          setAlarmSet(false);
        }
    }
}

  useEffect(() =&gt; {
    const interval = setInterval(() =&gt; {
      setTime(new Date());
      getAPI(&quot;https://ps70-final.vercel.app/alarm&quot;);
    }, 1000);

    return () =&gt; clearInterval(interval);

  }, []);

  function getRandomInt(min, max) {
    min = Math.ceil(min);
    max = Math.floor(max);
    return Math.floor(Math.random() * (max - min + 1)) + min;
  }

  function process(newValue) {
    setAlarmSet(true);
    setLoading(true);
    const jsonData = JSON.stringify({
      alarm: newValue.format(&#x27;h:mm A&#x27;),
    });

    fetch(&#x27;https://ps70-final.vercel.app/alarm&#x27;, {
      method: &#x27;POST&#x27;,
      mode: &#x27;cors&#x27;,
      headers: {
        &#x27;Accept&#x27;: &#x27;application/json&#x27;,
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
      },
      body: jsonData
    })
      .then(response =&gt; console.log(response))
  }

  function cancel() {
    setAlarmSet(false);
    setAlarm(&quot;&quot;);

    const jsonData = JSON.stringify({
      alarm: &quot;&quot;
    });
    fetch(&#x27;https://ps70-final.vercel.app/alarm&#x27;, {
      method: &#x27;POST&#x27;,
      mode: &#x27;cors&#x27;,
      headers: {
        &#x27;Accept&#x27;: &#x27;application/json&#x27;,
        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;
      },
      body: jsonData
    })
      .then(response =&gt; console.log(response))
  }

  return (
    &lt;div className=&quot;App&quot;&gt;
      &lt;LocalizationProvider dateAdapter={AdapterDayjs} localeText={
        {
          ...enUS,
          okButtonLabel: &quot;Set Alarm&quot;,
          cancelButtonLabel: &quot;Cancel&quot;,
        }
      }&gt;
        &lt;Container component=&quot;main&quot; maxWidth=&quot;sm&quot;&gt;
          &lt;Box
            sx={{
              marginTop: 8,
              display: &quot;flex&quot;,
              flexDirection: &quot;column&quot;,
              alignItems: &quot;center&quot;,
            }}
          &gt;
            &lt;h2&gt;The Current Time Is:&lt;/h2&gt;
            &lt;Typography component=&quot;h1&quot; variant=&quot;h1&quot;&gt;
              {time.toLocaleTimeString()}
            &lt;/Typography&gt;
            &lt;Alarm alarm={alarm} setAlarm={alarmSet} cancel={cancel} process={process} loading={loading}/&gt;
          &lt;/Box&gt;
        &lt;/Container&gt;
        &lt;div className=&quot;footer&quot;&gt;
          &lt;h5&gt;Created by Jackson Moody for PS70, May 2023&lt;/h5&gt;
        &lt;/div&gt;
      &lt;/LocalizationProvider&gt;
    &lt;/div&gt;
  );
}

export default App;
</code></span><button type="button" class="sc-bcXHqe WtpSJ"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="black"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div><div class="Content_code__iv5f1"><div class="sc-gswNZR inUGyR"><span style="font-size:inherit;font-family:inherit;background:white;color:black;border-radius:3px;display:inline;line-height:1.4285714285714286;overflow-x:auto;white-space:pre-wrap;padding:2px 4px"><code>import Typography from &quot;@mui/material/Typography&quot;;
  import { MobileTimePicker } from &#x27;@mui/x-date-pickers/MobileTimePicker&#x27;;
  import Button from &quot;@mui/material/Button&quot;;
  import CircularProgress from &#x27;@mui/material/CircularProgress&#x27;;
  import dayjs from &#x27;dayjs&#x27;;
  
  export default function Alarm(props) {
      if (props.setAlarm &amp;&amp; !props.loading) {
          return (
              &lt;&gt;
                  &lt;h2 component=&quot;h1&quot; variant=&quot;h4&quot;&gt;
                      Your Next Alarm Is Set For:
                  &lt;/h2&gt;
                  &lt;Typography component=&quot;h1&quot; variant=&quot;h1&quot;&gt;
                      {props.alarm}
                  &lt;/Typography&gt;
                  &lt;Button variant=&quot;contained&quot; size=&quot;large&quot; onClick={() =&gt; props.cancel()} sx={{ marginTop: 3 }}&gt;Reset Alarm&lt;/Button&gt;
              &lt;/&gt;
          )
      } else if (!props.loading) {
          return (
              &lt;&gt;
                  &lt;h2 component=&quot;h1&quot; variant=&quot;h4&quot;&gt;
                      You have no alarms set. Please select a time below:
                  &lt;/h2&gt;
                  &lt;MobileTimePicker
                      label=&quot;Set Alarm&quot;
                      defaultValue={dayjs()}
                      onAccept={(newValue) =&gt; props.process(newValue)}
                  /&gt;
              &lt;/&gt;
          )
      } else {
          return (
              &lt;CircularProgress sx={{marginTop: 5}}/&gt;
          )
      }
  }
</code></span><button type="button" class="sc-bcXHqe WtpSJ"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="black"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div><div class="Content_code__iv5f1"><div class="sc-gswNZR inUGyR"><span style="font-size:inherit;font-family:inherit;background:white;color:black;border-radius:3px;display:inline;line-height:1.4285714285714286;overflow-x:auto;white-space:pre-wrap;padding:2px 4px"><code>const express = require(&#x27;express&#x27;);
const cors=require(&quot;cors&quot;);

const app = express();
const port = 3000;

let stateOutput = {
  state: 0,
  id: 0,
};

let alarmOutput = {
  alarm: &quot;&quot;,
}

const corsOptions ={
   origin:&#x27;*&#x27;, 
   credentials:true,            
   optionSuccessStatus:200,
}

app.use(cors(corsOptions))
app.use(express.json());

app.get(&#x27;/alarm&#x27;, (req, res) =&gt; {
  res.send(alarmOutput);
})

app.get(&#x27;/state&#x27;, (req, res) =&gt; {
  res.send(stateOutput);
})

app.post(&#x27;/alarm&#x27;, (req, res) =&gt; {
  console.log(req.body);
  alarmOutput = {
    alarm: req.body.alarm,
  }
  res.send(&quot;Set data to {req.body.alarm}&quot;);
})

app.post(&#x27;/state&#x27;, (req, res) =&gt; {
  console.log(req.body);
  stateOutput = {
    state: req.body.state,
    id: req.body.id,
  }
  res.send(&quot;Set data to {req.body.state} and {req.body.id}&quot;);
})


app.listen(port, () =&gt; {
  console.log(&quot;API Started On Port {port}&quot;);
})

module.exports = app;
</code></span><button type="button" class="sc-bcXHqe WtpSJ"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="black"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW" id="AlarmSystem">Alarm Clock System (Week 11)</div><div class="Content_text__dw89L"><p>In week 11, we were tasked with working on the &quot;integrated design&quot; of our project. For me, this meant taking the ESP32 that I had connected to the internet last week and connecting it with the other components.</p><p>In particular, I followed <a href="https://randomnerdtutorials.com/esp32-esp8266-i2c-lcd-arduino-ide/" target="_blank">this Random Nerd Tutorial</a> to connect the ESP32 to an LCD display using I2C. Using my work from <a target="_blank" href="/PS70/week7">Week 7,</a> I also connected the ESP32 to a piezo buzzer and a button. By modifying the code from the previous week, I was able to make it such that the LCD displayed the current time and the buzzer played a tune if the current time matched a time set by the user.</p><p>Importantly, I also made it such that the ESP32 sent a POST request to the backend anytime the alarm went off or if the user pressed the silence button—this allows the other system (with the blinds and water) to stay up to date with the current state of the alarm.</p><p>Once everything was working correctly, I used <a href="https://en.makercase.com/" target="_blank">MakerCase</a> to create an enclosure for the system. After adding holes using <a href="https://inkscape.org/" target="_blank">Inkscape</a>, I then laser cut the enclosure out of 6mm thick wood and 3D printed a custom button for the top.</p><p>For reference, the full code running on the ESP32 is below, along with download links to the custom button and files for laser cutting the enclosure.</p></div></div><style data-emotion="css 1s50f5r">.css-1s50f5r{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}@media (min-width:600px){.css-1s50f5r{-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}}@media (min-width:900px){.css-1s50f5r{-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}}@media (min-width:1200px){.css-1s50f5r{-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}}@media (min-width:1536px){.css-1s50f5r{-webkit-flex-basis:50%;-ms-flex-preferred-size:50%;flex-basis:50%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:50%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6 css-1s50f5r"><div class="Content_rectanglemargins__RNF6q"><img alt="Interior" src="/PS70/_next/static/media/clockcomponents.379463ee.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6 css-1s50f5r"><div class="Content_rectanglemargins__RNF6q"><img alt="Exterior" src="/PS70/_next/static/media/alarm3.8c3e2365.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-15j76c0"><a href="/PS70/files/button.stl"><button class="Content_button__ikLVm">Download Button 3D Print</button></a><a href="/PS70/files/clockboxnew.pdf"><button class="Content_button__ikLVm">Download Laser Cutting Files</button></a><div class="Content_code__iv5f1"><div class="sc-gswNZR inUGyR"><span style="font-size:inherit;font-family:inherit;background:white;color:black;border-radius:3px;display:inline;line-height:1.4285714285714286;overflow-x:auto;white-space:pre-wrap;padding:2px 4px"><code>
  #include &lt;WiFi.h&gt;
  #include &lt;HTTPClient.h&gt;
  #include &lt;ArduinoJson.h&gt;
  #include &lt;Wire.h&gt;
  #include &lt;LiquidCrystal_I2C.h&gt;
  
  LiquidCrystal_I2C lcd(0x27, 16, 2);
  
  const char* ssid = &quot;INSERT WIFI NAME HERE&quot;;
  const char* password = &quot;INSERT WIFI PASSWORD HERE&quot;;
  
  const int tempo = 140;
  int state = 1;
  const int buttonPin = 4;
  const int buzzerPin = 32;
  boolean buttonPressed = false;
  String timeFormatted = &quot;&quot;;
  
  int melody[] = {
    //Add desired melody here, alternating the note and duration on each line
  };
  
  int notes = sizeof(melody) / sizeof(melody[0]) / 2;
  int wholenote = (60000 * 4) / tempo;
  int divider = 0, noteDuration = 0;
  
  String url = &quot;https://timeapi.io/api/Time/current/coordinate?latitude=42&amp;longitude=-71&quot;;
  String ip = &quot;&quot;;
  String alarmTime = &quot;&quot;;
  
  class Buzzer {
    int pin;
    unsigned long previousMillis;
    boolean outputTone;
  
  public:
    Buzzer(int inputPin) {
      pin = inputPin;
      previousMillis = 0;
      outputTone = false;
      pinMode(pin, INPUT);
    }
  
    void playSong() {
      for (int thisNote = 0; thisNote &lt; notes * 2; thisNote = thisNote + 2) {
        divider = melody[thisNote + 1];
        if (divider &gt; 0) {
          noteDuration = (wholenote) / divider;
        } else if (divider &lt; 0) {
          noteDuration = (wholenote) / abs(divider);
          noteDuration *= 1.5;
        }
        if (digitalRead(buttonPin) == HIGH || buttonPressed) {
          buttonPressed = true;
          lcd.clear();
          lcd.setCursor(0, 0);
          lcd.print(&quot;Current Time:&quot;);
          lcd.setCursor(0, 1);
          lcd.print(timeFormatted);
          return;
        }
        tone(pin, melody[thisNote], noteDuration * 0.9);
        delay(noteDuration);
        noTone(pin);
      }
    }
  
    void playAlarm() {
      while (digitalRead(buttonPin == LOW)) {
        byte buttonState = digitalRead(buttonPin);
        if (buttonState == HIGH) {
          buttonPressed = true;
          noTone(pin);
          lcd.clear();
          lcd.setCursor(0, 0);
          lcd.print(&quot;Current Time:&quot;);
          lcd.setCursor(0, 1);
          lcd.print(timeFormatted);
          HTTPClient http;
          http.begin(&quot;https://ps70-final.vercel.app/state&quot;);
          http.addHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);
          String bodyJson = &quot;{&quot;state&quot;:&quot; + String(1) + &quot;,&quot;id&quot;:&quot; + String(millis()) + &quot;}&quot;;
          http.POST(bodyJson);
          http.end();
          break;
        }
        unsigned long currentMillis = millis();
        if (outputTone) {
          if (currentMillis - previousMillis &gt;= 1000) {
            previousMillis = currentMillis;
            tone(pin, NOTE_E5, 1000);
            outputTone = false;
          }
        } else {
          if (currentMillis - previousMillis &gt;= 1000) {
            previousMillis = currentMillis;
            tone(pin, NOTE_E6, 1000);
            outputTone = true;
          }
        }
      }
    }
  };
  
  Buzzer buzzer(buzzerPin);
  
  void setup() {
    Serial.begin(115200);
    Wire.begin(18, 23);
    pinMode(buttonPin, INPUT);
  
    lcd.init();
    lcd.backlight();
    lcd.setCursor(0, 0);
  
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
      Serial.println(&quot;Connecting to WiFi&quot;);
      lcd.clear();
      lcd.print(&quot;Connecting to&quot;);
      lcd.setCursor(0, 1);
      lcd.print(&quot;WiFi...&quot;);
      delay(1000);
    }
    Serial.println(&quot;Connected to the WiFi network&quot;);
  
    ip = WiFi.localIP().toString();
  }
  
  void loop() {
    Wire.begin(18, 23);
    if ((WiFi.status() == WL_CONNECTED)) {
      HTTPClient http;
      http.begin(url);
      int httpResponseCode = http.GET();
  
      if (httpResponseCode &gt; 0) {
        DynamicJsonDocument doc(400);
        String payload = http.getString();
        DeserializationError error = deserializeJson(doc, payload);
        if (error) {
          Serial.println(&quot;Deserialization Error&quot;);
          return;
        }
        int hour = int(doc[&quot;hour&quot;]);
        int minute = int(doc[&quot;minute&quot;]);
        String minuteFormatted = &quot;&quot;;
        if (hour &gt; 12) {
          hour = hour - 12;
        } else if (hour == 0) {
          hour = 12;
        }
        if (minute &lt; 10) {
          minuteFormatted = &quot;0&quot; + String(minute);
        } else {
          minuteFormatted = String(minute);
        }
        String hourFormatted = String(hour);
        String colon = &quot;:&quot;;
        timeFormatted = hourFormatted + colon + minuteFormatted;
        if (int(doc[&quot;hour&quot;]) &gt;= 12) {
          timeFormatted += &quot; PM&quot;;
        } else {
          timeFormatted += &quot; AM&quot;;
        }
        Serial.println(&quot;Current Time: &quot; + timeFormatted);
        http.end();
  
        http.begin(&quot;https://ps70-final.vercel.app/alarm&quot;);
        int httpResponseCode = http.GET();
        if (httpResponseCode &gt; 0) {
          DynamicJsonDocument doc(400);
          String payload = http.getString();
          DeserializationError error = deserializeJson(doc, payload);
          if (error) {
            Serial.println(&quot;Deserialization Error&quot;);
            return;
          }
          alarmTime = doc[&quot;alarm&quot;].as&lt;String&gt;();
          Serial.println(&quot;Alarm Time: &quot; + alarmTime);
  
          int buttonState = digitalRead(buttonPin);
          if (buttonState == HIGH) {
            buttonPressed = true;
          }
  
          if (timeFormatted == alarmTime &amp;&amp; state == 1 &amp;&amp; !buttonPressed) {
            state = 2;
          }
        }
  
        http.end();
        http.begin(&quot;https://ps70-final.vercel.app/state&quot;);
        http.addHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);
        Serial.println(&quot;Current State: &quot; + String(state));
  
        if (state == 1) {
          if (timeFormatted != alarmTime) {
            buttonPressed = false;
          }
  
          lcd.clear();
          lcd.setCursor(0, 0);
          lcd.print(&quot;Current Time:&quot;);
          lcd.setCursor(0, 1);
          lcd.print(timeFormatted);
          String bodyJson = &quot;{&quot;state&quot;:&quot; + String(state) + &quot;,&quot;id&quot;:&quot; + String(millis()) + &quot;}&quot;;
          http.POST(bodyJson);
          http.end();
        } else if (state == 2 &amp;&amp; !buttonPressed) {
          lcd.clear();
          lcd.print(&quot;Alarm! Alarm!&quot;);
          lcd.setCursor(0, 1);
          lcd.print(&quot;Alarm! Alarm!&quot;);
          String bodyJson = &quot;{&quot;state&quot;:&quot; + String(state) + &quot;,&quot;id&quot;:&quot; + String(millis()) + &quot;}&quot;;
          http.POST(bodyJson);
          http.end();
          state = 3;
          buzzer.playSong();
        } else if (state == 3 &amp;&amp; !buttonPressed) {
          http.addHeader(&quot;Content-Type&quot;, &quot;application/json&quot;);
          String bodyJson = &quot;{&quot;state&quot;:&quot; + String(state) + &quot;,&quot;id&quot;:&quot; + String(millis()) + &quot;}&quot;;
          http.POST(bodyJson);
          http.end();
          buzzer.playAlarm();
        } else {  //Button Pressed
          state = 1;
        }
      }
    }
  }
  </code></span><button type="button" class="sc-bcXHqe WtpSJ"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="black"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW" id="MotorSystem">Shade/Water System (Weeks 12/13)</div><div class="Content_text__dw89L"><p>In our final weeks, the focus was on wrapping up the final project and tying up any loose ends. For me, this meant building out the last subsystem of the alarm clock: the one controlling the blinds and water pump.</p><p>From a software perspective, the code for this system was probably the simplest of the three. Indeed, the ESP32 simply polls the backend API using GET requests and instructs the stepper motor and/or pump if the latest state does not match the current state.</p><p>With regard to hardware, however, this system was definitely the most complex. In particular, I needed to 3D print an entire mount for the stepper motor, a water reservoir for the pump, and a nozzle to concentrate the spray of the water.</p><p>While the reservoir and casing for the stepper motor were relatively straightforward to design and print (and indeed, I took inspiration from <a href="https://www.thingiverse.com/thing:2631414" target="_blank">many similar designs</a>), I ran into significant difficulties with the gear attached to the stepper motor and the nozzle. Indeed, both prints had very tight tolerances—they had to align exactly with the blinds in my room and with the hose, respectively. However, seeing as 3D printing is a technology designed for rapid prototyping, I was able to iterate quickly through different designs until I found ones that worked.</p><p>From there, it was simply a matter of wiring everything together and fitting it within a laser cut enclosure (using a similar process as with the Week 11 system). To my surprise, everything still worked once put together—I was ready to start using my alarm!</p><p>For reference, the full code running on the ESP32 is below, along with download links to the stepper motor case, water reservoir, nozzle, and laser cut enclosure.</p></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6 css-1s50f5r"><div class="Content_rectanglemargins__RNF6q"><img alt="Interior" src="/PS70/_next/static/media/shadecomponents.183a08fa.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-6 css-1s50f5r"><div class="Content_rectanglemargins__RNF6q"><img alt="Exterior" src="/PS70/_next/static/media/alarm4.3966b0d1.jpeg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><style data-emotion="css o0rlmm">.css-o0rlmm{box-sizing:border-box;margin:0;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-basis:16.666667%;-ms-flex-preferred-size:16.666667%;flex-basis:16.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:16.666667%;}@media (min-width:600px){.css-o0rlmm{-webkit-flex-basis:16.666667%;-ms-flex-preferred-size:16.666667%;flex-basis:16.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:16.666667%;}}@media (min-width:900px){.css-o0rlmm{-webkit-flex-basis:16.666667%;-ms-flex-preferred-size:16.666667%;flex-basis:16.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:16.666667%;}}@media (min-width:1200px){.css-o0rlmm{-webkit-flex-basis:16.666667%;-ms-flex-preferred-size:16.666667%;flex-basis:16.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:16.666667%;}}@media (min-width:1536px){.css-o0rlmm{-webkit-flex-basis:16.666667%;-ms-flex-preferred-size:16.666667%;flex-basis:16.666667%;-webkit-box-flex:0;-webkit-flex-grow:0;-ms-flex-positive:0;flex-grow:0;max-width:16.666667%;}}</style><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Backing" src="/PS70/_next/static/media/backing.b2ecd3a6.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Front Case" src="/PS70/_next/static/media/frontcase.ab4393c6.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Gear Cover" src="/PS70/_next/static/media/cover.c1b94d0c.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Gear" src="/PS70/_next/static/media/gear.b7270ad2.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Nozzle" src="/PS70/_next/static/media/nozzle.e3048e65.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-2 css-o0rlmm"><div class="Content_rectanglemargins__RNF6q"><img alt="Water Holder" src="/PS70/_next/static/media/waterholder.6afb5853.jpg" decoding="async" data-nimg="fill" loading="lazy" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;object-fit:contain;color:transparent"/></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-15j76c0"><div class="Content_text__dw89L"><a href="/PS70/files/blind_print.zip"><button class="Content_button__ikLVm">Download Motor Casing 3D Print</button></a><a href="/PS70/files/nozzle.stl"><button class="Content_button__ikLVm">Download Nozzle 3D Print</button></a><a href="/PS70/files/waterholder.stl"><button class="Content_button__ikLVm">Download Reservoir 3D Print</button></a><a href="/PS70/files/motorboxnewest.pdf"><button class="Content_button__ikLVm">Download Laser Cutting Files</button></a></div><div class="Content_code__iv5f1"><div class="sc-gswNZR inUGyR"><span style="font-size:inherit;font-family:inherit;background:white;color:black;border-radius:3px;display:inline;line-height:1.4285714285714286;overflow-x:auto;white-space:pre-wrap;padding:2px 4px"><code>
  #include &lt;AccelStepper.h&gt;
  #include &lt;WiFi.h&gt;
  #include &lt;HTTPClient.h&gt;
  #include &lt;ArduinoJson.h&gt;
  
  const int stepPin = 13;
  const int dirPin = 12;
  const int pumpPin = 18;
  unsigned long previousMillis = 0;
  boolean pump = false;
  
  const char* ssid = &quot;INSERT WIFI NAME HERE&quot;;
  const char* password = &quot;INSERT WIFI PASSWORD HERE&quot;;
  
  String url = &quot;https://ps70-final.vercel.app/state&quot;;
  
  int state = 0;
  int pastId = 0;
  
  AccelStepper stepper(1, stepPin, dirPin);
  
  void blindUp() {
    stepper.runToNewPosition(10000);
  }
  
  void blindDown() {
    stepper.runToNewPosition(0);
  }
  
  void sendRequest() {
    if ((WiFi.status() == WL_CONNECTED)) {
      HTTPClient http;
      http.begin(url);
      int httpResponseCode = http.GET();
      if (httpResponseCode &gt; 0) {
        DynamicJsonDocument doc(400);
        String payload = http.getString();
        Serial.println(payload);
        DeserializationError error = deserializeJson(doc, payload);
        if (error) {
          Serial.println(&quot;Deserialization Error&quot;);
          return;
        }
        int newId = int(doc[&quot;id&quot;]);
        if (newId != pastId) {
          state = int(doc[&quot;state&quot;]);
          pastId = newId;
        }
      }
    }
  }
  
  void setup() {
    Serial.begin(9600);
  
    pinMode(pumpPin, OUTPUT);
    digitalWrite(pumpPin, HIGH);
  
    WiFi.mode(WIFI_STA);
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
      Serial.println(&quot;Connecting to WiFi&quot;);
      delay(1000);
    }
    Serial.println(&quot;Connected to the WiFi network&quot;);
  
    stepper.setMaxSpeed(500);
    stepper.setAcceleration(500);
  }
  
  void loop() {
    unsigned long currentMillis = millis();
    sendRequest();
  
    if (state == 1) {
      digitalWrite(pumpPin, HIGH);
      blindDown();
    } else if (state == 2) {
      blindUp();
    } else if (state == 3) {
      if (currentMillis - previousMillis &gt;= 400) {
        previousMillis = currentMillis;
        if (pump) {
          digitalWrite(pumpPin, LOW);
        } else {
          digitalWrite(pumpPin, HIGH);
        }
        pump = !pump;
      }
    }
  }</code></span><button type="button" class="sc-bcXHqe WtpSJ"><svg class="icon" viewBox="0 0 384 512" width="16pt" height="16pt" fill="black"><path d="M280 240H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm0 96H168c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h112c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zM112 232c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zm0 96c-13.3 0-24 10.7-24 24s10.7 24 24 24 24-10.7 24-24-10.7-24-24-24zM336 64h-80c0-35.3-28.7-64-64-64s-64 28.7-64 64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM192 48c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm144 408c0 4.4-3.6 8-8 8H56c-4.4 0-8-3.6-8-8V120c0-4.4 3.6-8 8-8h40v32c0 8.8 7.2 16 16 16h160c8.8 0 16-7.2 16-16v-32h40c4.4 0 8 3.6 8 8v336z"></path></svg></button></div></div></div><div class="MuiGrid-root MuiGrid-item MuiGrid-grid-xs-12 css-sz8yim"><div class="Content_section__fSmTW">Reflection</div><div class="Content_text__dw89L"><p>Overall, I am quite happy with how this project turned out! It accomplishes everything that I set out for it to do, and I look forward to using it in my own life in the coming semesters. While I put countless hours into this project (and spent many late nights in the lab), seeing it all come together and being able to present it to others at the PS70 fair made it all worth it!</p><p>That being said, no project is perfect, and there are certainly a couple areas that I could improve upon if given more time. In particular, the current software is only designed to handle one alarm and alarm clock at a time. However, it would be cool to scale the backend up to handle multiple devices with multiple alarms on each. Additionally, the 3D printed water reservoir is subject to leaking and cannot be sealed off. However, this issue could be resolved using vacuum forming or a similar technology.</p><p>Going forward, I want to continue working on these goals and really take this project to the next level. If you&#x27;re interested in learning more or helping me out, please <a href="mailto:jacksonmoody@college.harvard.edu">reach out!</a></p></div><a href="/PS70"><button class="Content_button__ikLVm">Return Home</button></a></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/finalproject","query":{},"buildId":"qLkYmdwpuw8oBP6NAldma","assetPrefix":"/PS70","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>