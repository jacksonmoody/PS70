(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8976],{8509:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/week9",function(){return t(1930)}])},8492:function(e,n,t){"use strict";t.d(n,{Z:function(){return d}});var i=t(5893),o=t(7379),r=t.n(o),s=t(5675),a=t.n(s);function d(e){let{image:n,title:t}=e;return(0,i.jsxs)("div",{className:r().header,children:[(0,i.jsx)(a(),{src:n,alt:t,fill:!0,style:{objectFit:"cover"}}),(0,i.jsx)("div",{className:r().title,children:(0,i.jsx)("h1",{children:t})})]})}},1930:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return u}});var i=t(5893),o=t(1664),r=t.n(o),s=t(9008),a=t.n(s),d=t(8492),c=t(7465),l=t.n(c),p=t(960),h=t(9927);function u(){return(0,i.jsxs)("div",{children:[(0,i.jsx)(a(),{children:(0,i.jsx)("title",{children:"PS70 Portfolio: Week 9"})}),(0,i.jsx)(d.Z,{image:"https://i.imgur.com/kNoe3ur.jpg",title:"Week 9"}),(0,i.jsxs)("div",{className:l().content,children:[(0,i.jsxs)(p.ZP,{container:!0,alignItems:"flex-start",justifyContent:"center",columnSpacing:10,sx:{marginTop:5},children:[(0,i.jsxs)(p.ZP,{item:!0,xs:12,order:{xs:1,sm:1},children:[(0,i.jsx)("div",{className:l().section,children:"Networking and IoT"}),(0,i.jsx)("video",{width:"80%",height:"auto",autoPlay:!0,loop:!0,muted:!0,children:(0,i.jsx)("source",{src:"car_demo.mp4",type:"video/mp4"})})]}),(0,i.jsxs)(p.ZP,{item:!0,xs:12,order:{xs:1,sm:1},mt:10,children:[(0,i.jsx)("div",{className:l().section,children:"Creating a Wi-Fi Car"}),(0,i.jsxs)("div",{className:l().text,children:[(0,i.jsxs)("p",{children:["For this week's assignment, we were tasked with using networking and the internet of things to create a project. In particular, I chose to work with ",(0,i.jsx)("a",{href:"https://guoingup.github.io/PS70-Digital-Fabrication/",children:"Claire Guo"})," and ",(0,i.jsx)("a",{href:"https://cjleggett.github.io/ps70/index.html?first=False",children:"Connor Leggett"})," to create a Wi-Fi controllable car!"]}),(0,i.jsx)("p",{children:"To create this car, we needed three main components: An ESP32 to monitor inputs (from buttons and from an RFID scanner), an API to monitor the state of these inputs, and an ESP32 to fetch data from the API and control the car motors! "})]})]})]}),(0,i.jsxs)(p.ZP,{item:!0,xs:12,order:{xs:2,sm:2},children:[(0,i.jsxs)("div",{className:l().text,children:[(0,i.jsx)("h1",{children:"Monitoring Inputs"}),(0,i.jsx)("p",{children:"The first major component of this project was a device to monitor inputs. In particular, we chose to use an ESP32 connected to 4 buttons (and later an RFID scanner) to detect user input. Depending on the input, the ESP32 then used the code below to send the appropriate request to the API."})]}),(0,i.jsx)("div",{className:l().code,children:(0,i.jsx)(h.Z1,{text:'\n  #include "Buttons.h"\n  #include "Constants.h"\n  #include <WiFi.h>\n  #include <HTTPClient.h>\n  #include <ArduinoJson.h>\n  \n  const char* ssid = "MAKERSPACE";\n  const char* password = "12345678";\n  String directions[4] = {"forward", "backward", "left", "right"};\n  \n  const String speedUrl = "https://ps70-api.vercel.app/speed";\n  const String directionUrl = "https://ps70-api.vercel.app/direction";\n  int lowerBounds[] = {400, 100, 750, 2400};\n  int upperBounds[] = {500, 200, 850, 2600};\n  \n  Buttons bs = Buttons(BUTTON_PIN, lowerBounds, upperBounds);\n  \n  void setup() {\n    Serial.begin(115200);\n    WiFi.begin(ssid, password);\n    while (WiFi.status() != WL_CONNECTED) {\n      delay(1000);\n      Serial.println("Connecting to WiFi");\n    }\n    Serial.println("Connected to the WiFi network");\n  }\n  \n  void loop() {\n    int buttonValue = bs.detectStart();\n    if (buttonValue != -1) {\n      Serial.println(buttonValue);\n      String direction = directions[buttonValue];\n      Serial.println("direction=" + direction + "&time=" + millis());\n      if ((WiFi.status() == WL_CONNECTED)) {\n        HTTPClient http;\n        http.begin(directionUrl + "?direction=" + direction + "&time=" + millis());\n        int httpResponseCode = http.POST("");\n        String payload = http.getString();\n        Serial.println(payload);\n        Serial.println(httpResponseCode);\n        http.end();\n      }\n    }\n  }',language:"c",wrapLines:!0,theme:h.HI})}),(0,i.jsx)(r(),{href:"/files/Inputs.ino",locale:!1,children:(0,i.jsx)("button",{className:l().button,children:"Download Code"})})]}),(0,i.jsxs)(p.ZP,{item:!0,xs:12,order:{xs:3,sm:3},children:[(0,i.jsxs)("div",{className:l().text,children:[(0,i.jsx)("h1",{children:"Creating an API"}),(0,i.jsx)("p",{children:"Next, we needed to create an API so that the ESP32's could communicate with each other over Wi-Fi and the internet. Rather than using Firebase, I decided to build out the API from scratch using Node.js and Express. Given the fact that we didn't need to store large amounts of data, as well as the fact that I was already familiar with building backend applications using Node.js, this seemed like the ideal choice."}),(0,i.jsx)("p",{children:"Ultimately, the API has two routes which can be both modified (using POST requests) and read from (using GET requests). The /speed route takes the speed parameter and can be used to set the speed at which the motors rotate. The /direction route takes the direction parameter as well as a time parameter, which specify the direction for the robot to move in and the time at which the request was sent, respectively."}),(0,i.jsxs)("p",{children:["Today, the API is publicly available and hosted using Vercel. This means that we can control our car from anywhere in the world with an internet connection! The full code for the API can be viewed below, and you can access it ",(0,i.jsx)("a",{href:"https://ps70-api.vercel.app/",children:"here"}),"."]})]}),(0,i.jsx)("div",{className:l().code,children:(0,i.jsx)(h.Z1,{text:"\nconst express = require('express');\nconst app = express();\nconst port = 3000;\n\napp.get('/', (req, res) => {\n  res.send(\"The current direction is app.get('direction') and the current speed is app.get('speed')\");\n})\n\napp.get('/direction', (req, res) => {\n  res.json({ direction: app.get('direction'), time: app.get('time') })\n})\n\napp.get('/speed', (req, res) => {\n   res.send(app.get('speed'));\n  })\n\napp.post('/direction', (req, res) => {\n  console.log(\"New Direction Request\");\n  app.set('direction', req.query.direction);\n  app.set('time', req.query.time);\n  res.send(\"Set direction to app.get('direction') and time to app.get('time')\");\n})\n\napp.post('/speed', (req, res) => {\n  console.log(\"New Speed Request\");\n  app.set('speed', req.query.speed);\n  res.send(\"Set speed to app.get('speed')\");\n})\n\napp.listen(port, () => {\n  console.log(\"API Started On Port (port)\");\n})\n\nmodule.exports = app;\n",language:"javascript",wrapLines:!0,theme:h.HI})}),(0,i.jsx)(r(),{href:"/files/api.js",locale:!1,children:(0,i.jsx)("button",{className:l().button,children:"Download Code"})})]}),(0,i.jsxs)(p.ZP,{item:!0,xs:12,order:{xs:4,sm:4},children:[(0,i.jsxs)("div",{className:l().text,children:[(0,i.jsx)("h1",{children:"Driving the Car"}),(0,i.jsx)("p",{children:"Lastly, we needed to create the car itself and drive it by fetching data from the API. Connor primarily focused on the construction of the car (a 3D printed base with slots for two motors and a ping pong ball), while I focused more on the code driving the motors."}),(0,i.jsx)("p",{children:"In particular, I used the Wifi, HttpClient, and ArduinoJson libraries to fetch data from the API as a JSON and parse it into the relevant information. If the data from the API is valid and new (meaning that it has a different timestamp than the previously sent request), the ESP32 instructs the motors accordingly."}),(0,i.jsx)("p",{children:"Given that one ESP32 needs to send a POST request and another ESP32 needs to send a GET request everytime the robot moves, the movements of the car are somewhat delayed (as can be seen in the video above). While a more responsive car could likely be created using Bluetooth, I am overall very happy with how this project turned out!"})]}),(0,i.jsx)("div",{className:l().code,children:(0,i.jsx)(h.Z1,{text:'\n#include <WiFi.h>\n#include <HTTPClient.h>\n#include <ArduinoJson.h>\n\nconst char* ssid = "MAKERSPACE";\nconst char* password = "12345678";\n\nconst String speedUrl = "https://ps70-api.vercel.app/speed";\nconst String directionUrl = "https://ps70-api.vercel.app/direction";\n\nconst int motor1A = 18;\nconst int motor1B = 23;\nconst int motor2A = 10;\nconst int motor2B = 5;\n\nconst int freq = 5000;\nconst int channel1 = 0;\nconst int channel2 = 1;\nconst int resolution = 8;\n\nint previousTime = 0;\n\nclass Motor {\n  int A1A;\n  int A1B;\n  int speed;\n  int direction;\n\npublic:\n  Motor(int channel, int pinB) {\n    A1A = channel;\n    A1B = pinB;\n    speed = 0;\n    direction = 0;\n\n    pinMode(A1A, OUTPUT);\n    pinMode(A1B, OUTPUT);\n  }\n\n  void driveMotor(byte d, int s) {\n    if (d == 1) {\n      ledcWrite(A1A, 255 - s);\n      digitalWrite(A1B, HIGH);\n    } else if (d == 0) {\n      ledcWrite(A1A, s);\n      digitalWrite(A1B, LOW);\n    }\n  }\n\n  void setSpeed(int newSpeed) {\n    speed = newSpeed;\n  }\n\n  void setDirection(int newDirection) {\n    direction = newDirection;\n  }\n\n  void update() {\n    if (direction == 0) {\n      driveMotor(LOW, speed);\n    } else if (direction == 1) {\n      driveMotor(HIGH, speed);\n    }\n  }\n};\n\nMotor motor1(channel1, motor1B);\nMotor motor2(channel2, motor2B);\n\nvoid setup() {\n\n  ledcSetup(channel1, freq, resolution);\n  ledcAttachPin(motor1A, channel1);\n\n  ledcSetup(channel2, freq, resolution);\n  ledcAttachPin(motor2A, channel2);\n\n  Serial.begin(115200);\n  WiFi.begin(ssid, password);\n  while (WiFi.status() != WL_CONNECTED) {\n    delay(1000);\n    Serial.println("Connecting to WiFi");\n  }\n  Serial.println("Connected to the WiFi network");\n}\n\nvoid loop() {\n  Serial.println("Refreshing");\n  int time = 0;\n  int speed = 0;\n  String direction = "";\n\n  if ((WiFi.status() == WL_CONNECTED)) {\n    HTTPClient http;\n    http.begin(speedUrl);\n    int httpResponseCode = http.GET();\n\n    if (httpResponseCode > 0) {\n      String payload = http.getString();\n      speed = payload.toInt();\n    }\n    http.end();\n\n    http.begin(directionUrl);\n    httpResponseCode = http.GET();\n\n    if (httpResponseCode > 0) {\n      String payload = http.getString();\n      DynamicJsonDocument doc(64);\n      DeserializationError error = deserializeJson(doc, payload);\n      if (error) {\n        Serial.println("Deserialization Error");\n        time = 1;\n        direction = "";\n        return;\n      }\n      direction = doc["direction"].as<String>();\n      time = int(doc["time"]);\n    }\n    http.end();\n\n    Serial.println(speed);\n    Serial.println(direction);\n    Serial.println(time);\n\n    motor1.setSpeed(speed);\n    motor2.setSpeed(speed);\n\n    if (time != previousTime) {\n      previousTime = time;\n      if (direction == "left") {\n        motor1.setDirection(1);\n        motor2.setDirection(0);\n        pause(290);\n      } else if (direction == "right") {\n        motor1.setDirection(0);\n        motor2.setDirection(1);\n        pause(290);\n      } else if (direction == "backward") {\n        motor1.setDirection(0);\n        motor2.setDirection(0);\n        pause(500);\n      } else if (direction == "forward") {\n        motor1.setDirection(1);\n        motor2.setDirection(1);\n        pause(500);\n      }\n    }\n  }\n}\n\nvoid pause(int duration) {\n  motor1.update();\n  motor2.update();\n  delay(duration);\n  motor1.setSpeed(0);\n  motor2.setSpeed(0);\n  motor1.update();\n  motor2.update();\n}\n',language:"javascript",wrapLines:!0,theme:h.HI})}),(0,i.jsx)(r(),{href:"/files/Wifi-Car.ino",locale:!1,children:(0,i.jsx)("button",{className:l().button,children:"Download Code"})}),(0,i.jsx)(r(),{href:"/",children:(0,i.jsx)("button",{className:l().button,children:"Return Home"})})]})]})]})}},7465:function(e){e.exports={button:"Content_button__ikLVm",buttonlarge:"Content_buttonlarge__iwvZl",code:"Content_code__iv5f1",section:"Content_section__fSmTW",text:"Content_text__dw89L",list:"Content_list__KcVo5",link:"Content_link__LtZ2C",circle:"Content_circle__6dNze",square:"Content_square__yT2Rj",rectangle:"Content_rectangle__enz6o",rectanglemargins:"Content_rectanglemargins__RNF6q",rectanglesmall:"Content_rectanglesmall__NvPZa",rectanglexs:"Content_rectanglexs__nI28D",content:"Content_content__pTaRN"}},7379:function(e){e.exports={header:"Header_header__l1qoc",title:"Header_title__MaSJ1"}}},function(e){e.O(0,[1664,7406,9927,9774,2888,179],function(){return e(e.s=8509)}),_N_E=e.O()}]);